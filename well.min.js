!function(){"use strict";function t(){for(var t,e=c.slice(0).reverse(),n=c.length;--n>=0;)t=this.modules[e[n]],t&&(e.splice(n,1),t.exportsFn.call(t));c=e.slice(0).reverse()}var e=function(){},n=Object.keys,i=Object.prototype,r=i.hasOwnProperty,s=i.toString,o=(Function.prototype.bind,function(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,i){return t.call(e,n,i)};case 3:return function(n,i,r){return t.call(e,n,i,r)};case 4:return function(n,i,r,s){return t.call(e,n,i,r,s)}}return function(){return t.apply(e,arguments)}});e.prototype.iteratee=function(t,e,n){return this.isFunction(t)?o(t,e,n):this.isObject(t)?this.matches(t):this.property(t)},e.prototype.matches=function(t){var e=this.pairs(t),n=e.length;return function(t){if(null==t)return!n;t=new Object(t);for(var i=0;n>i;i++){var r=e[i],s=r[0];if(r[1]!==t[s]||!(s in t))return!1}return!0}},e.prototype.pairs=function(t){for(var e=this.keys(t),n=e.length,i=Array(n),r=0;n>r;r++)i[r]=[e[r],t[e[r]]];return i},e.prototype.property=function(t){return function(e){return e[t]}},e.prototype.isFunction=function(t){return"function"==typeof t||!1},e.prototype.each=function(t,e,n){if(null==t)return t;e=o(e,n);var i,r=t.length;if(r===+r)for(i=0;r>i;i++)e(t[i],i,t);else{var s=this.keys(t);for(i=0,r=s.length;r>i;i++)e(t[s[i]],s[i],t)}return t},e.prototype.map=function(t,e,n){if(null==t)return[];e=this.iteratee(e,n);for(var i,r=t.length!==+t.length&&this.keys(t),s=(r||t).length,o=Array(s),u=0;s>u;u++)i=r?r[u]:u,o[u]=e(t[i],i,t);return o},e.prototype.has=function(t,e){return null!=t&&r.call(t,e)},e.prototype.keys=function(t){if(!this.isObject(t))return[];if(n)return n(t);var e=[];for(var i in t)this.has(t,i)&&e.push(i);return e},e.prototype.extend=function(t){if(!this.isObject(t))return t;for(var e,n,i=1,s=arguments.length;s>i;i++){e=arguments[i];for(n in e)r.call(e,n)&&(t[n]=e[n])}return t},e.prototype.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},e.prototype.isArray=function(t){return"[object Array]"===s.call(t)},e.prototype.clone=function(t){return this.isObject(t)?this.isArray(t)?t.slice():this.extend({},t):t},e.prototype.some=function(t,e,n){if(null==t)return!1;e=this.iteratee(e,n);var i,r,s=t.length!==+t.length&&this.keys(t),o=(s||t).length;for(i=0;o>i;i++)if(r=s?s[i]:i,e(t[r],r,t))return!0;return!1},e.prototype.find=function(t,e,n){var i;return e=this.iteratee(e,n),this.some(t,function(t,n,r){return e(t,n,r)?(i=t,!0):void 0}),i},e.prototype.filter=function(t,e,n){var i=[];return null==t?i:(e=this.iteratee(e,n),this.each(t,function(t,n,r){e(t,n,r)&&i.push(t)}),i)},e.prototype.merge=function(){var t=[];return this.each(arguments,function(e){for(var n,i=e.length,r=-1;++r<i;)n=e[r],-1===t.indexOf(n)&&t.push(n)}),t},e.prototype.parseName=function(t){var e=t.split(":"),n=e[e.length-1];return e.splice(-1,1),{alias:e.join(":"),name:n}};var u=u?u:new e,a=function(){var t=function(t,e){var n,i=-1,r=t.length,s=e[0],o=e[1],u=e[2];switch(e.length){case 0:for(;++i<r;)(n=t[i]).callback.call(n.ctx);return;case 1:for(;++i<r;)(n=t[i]).callback.call(n.ctx,s);return;case 2:for(;++i<r;)(n=t[i]).callback.call(n.ctx,s,o);return;case 3:for(;++i<r;)(n=t[i]).callback.call(n.ctx,s,o,u);return;default:for(;++i<r;)(n=t[i]).callback.apply(n.ctx,e);return}};return{on:function(t,e,n){this._events||(this._events={});var i=this._events[t]||(this._events[t]=[]);return i.push({callback:e,context:n,ctx:n||this}),this},off:function(t,e,n){var i,r,s,o,a,c,h,l;if(!t&&!e&&!n)return this._events=void 0,this;for(o=t?[t]:u.keys(this._events),a=0,c=o.length;c>a;a++)if(t=o[a],s=this._events[t]){if(this._events[t]=i=[],e||n)for(h=0,l=s.length;l>h;h++)r=s[h],(e&&e!==r.callback&&e!==r.callback._callback||n&&n!==r.context)&&i.push(r);i.length||delete this._events[t]}return this},trigger:function(e){if(!this._events)return this;var n=[].slice.call(arguments,1),i=this._events[e],r=this._events.all;return i&&t(i,n),r&&t(r,arguments),this}}},c=[],h=function(t,e,n,i){u.extend(this,{app:i,name:t,deps:[],options:{},isComplete:!0,exportsFn:function(){}});try{e.call(this,i,i.Modules)}catch(r){console.log("error in module: "+t)}this._setType(this.options.type||t.split(":")[0]),this.deps.length?this.waitForDeps(n):n(this)};u.extend(h.prototype,{use:function(t,e){return e=e||{},e.autoInit&&c.push(t),this.deps.push({name:this._toFullName(t),options:e}),this},set:function(t){return this.options=t||{},this},exports:function(t){return this.exportsFn=t,this},get:function(t){return this.options[t]},getAlias:function(){var t=this.name.split(":");return t.splice(-1,1),t.join(":")},getShorthand:function(){var t=this.name.split(":");return t.splice(-1,1)},_isShortHand:function(t){return":"===t[0]},_toFullName:function(t){if(!this._isShortHand(t))return t;var e=this.name.split(":");return e.splice(-1,1),e.join(":")+t},_setType:function(t){switch("s"===t.substr(-1)&&(t=t.slice(0,-1)),t.toLowerCase()){case"view":this.isView=!0;break;case"model":this.isModel=!0;break;case"collection":this.isCollection=!0;break;case"plugin":this.isPlugin=!0;break;case"well":this.isCore=!0}return this.options.type=t,this},_defineDeps:function(){var t,e=this.app.Modules;u.each(this.deps,function(n){t=n.options.as||u.parseName(n.name).name,this[t]=e.get(n.name)},this)},waitForDeps:function(t){if(this.app.isProduction)this._defineDeps(),t(this);else{this.isComplete=!1;var e=this.app.Modules,n=u.map(this.deps,function(t){return t.name}),i=(u.clone(e.findMissing(n)),this);e.require(n,function(e){return e?console.log("Error in deps requiring...",e):(i._defineDeps(),void t(i))})}return this}});var l=function(t,e,n){this.modules={},this.app=n,this.names=t,this.next=e,n.Modules.on("MODULE_DEFINED",this.onModuleDefined,this)};u.extend(l.prototype,{isQueueEmpty:function(){return!this.names.length},onModuleDefined:function(e,n){if(this.isModuleFromThisQueue(e.name)){if(this.modules[e.name]=e,this.names.splice(this.names.indexOf(e.name),1),this.isQueueEmpty()){var i=this.app;i.Modules.off("MODULE_DEFINED",this.onModuleDefined,this);var r=u.extend(this.modules,i.Modules.getDeps(this.modules));t.call(this),this.next(n,r)}return this}},isModuleFromThisQueue:function(t){return!!u.find(this.names,function(e){return e===t})}});var p=function(t){this.app=t,this.modules={},this.init()};u.extend(p.prototype,a(),{get:function(t){return this.modules[t].exportsFn},getModule:function(t){return this.modules[t]},define:function(t,e){var n=this;return new h(t,e,function(e){n.modules[t]=e,n.trigger("MODULE_DEFINED",e)},this.app),this},init:function(){return window.wellDefine=this.define.bind(this),this},findBy:function(t,e){return u.find(this.modules,function(n){return n.props[t]===e},this)},filterBy:function(t,e){return t&&e?u.filter(this.modules,function(n){return n.props[t]===e},this):void 0},require:function(t,e,n){var i=this.findMissing(t);return i.length?(new l(u.clone(i),e,this.app),this.app.isProduction||(i=u.map(i,function(t){return this.app.transformToPath(t)},this),this.vendorRequire(i,function(){},function(t){e(t)})),this):e(n,this.pack(t))},requireConfig:function(t){return requirejs.config({urlArgs:t.cache===!1?(new Date).getTime():"",waitSeconds:60,baseUrl:t.appRoot,paths:{well:t.wellRoot,plugins:t.pluginsRoot,vendor:t.vendorRoot}}),this},vendorRequire:function(t,e,n){require(t,e,n)},exist:function(t){return u.find(this.modules,function(e){return e.name===t},this)},findMissing:function(t){return u.filter(t,function(t){return!this.exist(t)},this)},pack:function(t){var e={};return u.each(t,function(t){e[t]=this.getModule(t)},this),u.extend(e,this.getDeps(e))},getDeps:function(t){var e={};return u.each(t,function(t){u.each(t.deps,function(t){e[t]=this.getModule(t.name)},this)},this),e}});var f=function(t,e){this.isProduction=t.isProduction,this.options=t,this.name=this.options.appName||"WellApp",window[this.name]=this,"function"==typeof define&&define.amd&&(define.amd=e),this.init()};u.extend(f.prototype,{init:function(){var t=this.options;if(u.isFunction(t.vendorRequire)&&(h.prototype.vendorRequire=t.vendorRequire),u.isFunction(t.requireConfig)&&(h.prototype.requireConfig=t.requireConfig),this.Modules=new p(this),this.isProduction||this.Modules.requireConfig(t),!t.strategy)return console.log("There is no application strategy defined");var e=this;this.Modules.require([t.strategy],function(n){return n?console.log("Error in strategy loading! ",n):void(e.Strategy=new(e.Modules.get(t.strategy)))})},transformToPath:function(t){return t?t.split(/(?=[A-Z])/).join("-").toLowerCase().split(":-").join("/"):t},transformToName:function(t){return t?(t=this.capitalize(t.replace(/^\//,"").split("/")).join(":"),this.capitalize(t.split("-")).join("")):void 0},capitalize:function(t){return u.map(t,function(t){return t.charAt(0).toUpperCase()+t.slice(1)})}}),new f(window.WellConfig||{})}();