!function(){"use strict";var t=function(){},e=Object.keys,n=Object.prototype,i=n.hasOwnProperty,r=n.toString,s=function(t,e,n){if(void 0===e)return t;switch(null==n?3:n){case 1:return function(n){return t.call(e,n)};case 2:return function(n,i){return t.call(e,n,i)};case 3:return function(n,i,r){return t.call(e,n,i,r)};case 4:return function(n,i,r,s){return t.call(e,n,i,r,s)}}return function(){return t.apply(e,arguments)}};t.prototype.iteratee=function(t,e,n){return this.isFunction(t)?s(t,e,n):this.isObject(t)?this.matches(t):this.property(t)},t.prototype.matches=function(t){var e=this.pairs(t),n=e.length;return function(t){if(null==t)return!n;t=new Object(t);for(var i=0;n>i;i++){var r=e[i],s=r[0];if(r[1]!==t[s]||!(s in t))return!1}return!0}},t.prototype.pairs=function(t){for(var e=this.keys(t),n=e.length,i=Array(n),r=0;n>r;r++)i[r]=[e[r],t[e[r]]];return i},t.prototype.property=function(t){return function(e){return e[t]}},t.prototype.isFunction=function(t){return"function"==typeof t||!1},t.prototype.each=function(t,e,n){if(null==t)return t;e=s(e,n);var i,r=t.length;if(r===+r)for(i=0;r>i;i++)e(t[i],i,t);else{var o=this.keys(t);for(i=0,r=o.length;r>i;i++)e(t[o[i]],o[i],t)}return t},t.prototype.map=function(t,e,n){if(null==t)return[];e=this.iteratee(e,n);for(var i,r=t.length!==+t.length&&this.keys(t),s=(r||t).length,o=Array(s),u=0;s>u;u++)i=r?r[u]:u,o[u]=e(t[i],i,t);return o},t.prototype.has=function(t,e){return null!=t&&i.call(t,e)},t.prototype.keys=function(t){if(!this.isObject(t))return[];if(e)return e(t);var n=[];for(var i in t)this.has(t,i)&&n.push(i);return n},t.prototype.extend=function(t){if(!this.isObject(t))return t;for(var e,n,r=1,s=arguments.length;s>r;r++){e=arguments[r];for(n in e)i.call(e,n)&&(t[n]=e[n])}return t},t.prototype.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},t.prototype.isArray=function(t){return"[object Array]"===r.call(t)},t.prototype.clone=function(t){return this.isObject(t)?this.isArray(t)?t.slice():this.extend({},t):t},t.prototype.some=function(t,e,n){if(null==t)return!1;e=this.iteratee(e,n);var i,r,s=t.length!==+t.length&&this.keys(t),o=(s||t).length;for(i=0;o>i;i++)if(r=s?s[i]:i,e(t[r],r,t))return!0;return!1},t.prototype.find=function(t,e,n){var i;return e=this.iteratee(e,n),this.some(t,function(t,n,r){return e(t,n,r)?(i=t,!0):void 0}),i},t.prototype.filter=function(t,e,n){var i=[];return null==t?i:(e=this.iteratee(e,n),this.each(t,function(t,n,r){e(t,n,r)&&i.push(t)}),i)};var o=o?o:new t,u=function(){var t=function(t,e){var n,i=-1,r=t.length,s=e[0],o=e[1],u=e[2];switch(e.length){case 0:for(;++i<r;)(n=t[i]).callback.call(n.ctx);return;case 1:for(;++i<r;)(n=t[i]).callback.call(n.ctx,s);return;case 2:for(;++i<r;)(n=t[i]).callback.call(n.ctx,s,o);return;case 3:for(;++i<r;)(n=t[i]).callback.call(n.ctx,s,o,u);return;default:for(;++i<r;)(n=t[i]).callback.apply(n.ctx,e);return}};return{on:function(t,e,n){this._events||(this._events={});var i=this._events[t]||(this._events[t]=[]);return i.push({callback:e,context:n,ctx:n||this}),this},off:function(t,e,n){var i,r,s,u,c,a,h,l;if(!t&&!e&&!n)return this._events=void 0,this;for(u=t?[t]:o.keys(this._events),c=0,a=u.length;a>c;c++)if(t=u[c],s=this._events[t]){if(this._events[t]=i=[],e||n)for(h=0,l=s.length;l>h;h++)r=s[h],(e&&e!==r.callback&&e!==r.callback._callback||n&&n!==r.context)&&i.push(r);i.length||delete this._events[t]}return this},trigger:function(e){if(!this._events)return this;var n=[].slice.call(arguments,1),i=this._events[e],r=this._events.all;return i&&t(i,n),r&&t(r,arguments),this}}},c=[],a=function(t,e,n,i){o.extend(this,{app:i,name:t,deps:[],options:{},onCompleteFns:[],isComplete:!0});try{e.call(this,i)}catch(r){console.log("error in module: "+t)}this._setType(this.options.type||t.split(":")[0]),this.deps.length?this.waitForDeps(n):n(this)};o.extend(a.prototype,{use:function(t,e){return e&&c.push(t),this.deps.push(this._toFullName(t)),this},options:function(t){var e=t||{};return e.template=this._toFullName(e.template),this.options=e,this},exports:function(t){this.exportFn=t;var e=c.indexOf(this.name);return-1!==e&&(c.splice(e,1),t()),this},getOption:function(t){return this.options[t]},_isShortHand:function(t){return":"===t[0]},_toFullName:function(t){if(!this._isShortHand(t))return t;var e=this.name.split(":");return e.splice(-1,1),e.join(":")+t},_setType:function(t){switch("s"===t.substr(-1)&&(t=t.slice(0,-1)),t.toLowerCase()){case"view":this.isView=!0;break;case"model":this.isModel=!0;break;case"collection":this.isCollection=!0;break;case"plugin":this.isPlugin=!0;break;case"well":this.isCore=!0}return this.options.type=t,this},waitForDeps:function(t){if(this.app.isProduction)t(this);else{this.isComplete=!1;var e=this.app.Modules,n=(o.clone(e.findMissing(this.deps)),this);e.require(this.deps,function(){t(n)},function(t){console.log("Error in deps requiring...",t)})}return this}});var h=function(t,e,n){this.modules={},this.app=n,this.names=t,this.next=e,n.Modules.on("MODULE_DEFINED",this.onModuleDefined,this)};o.extend(h.prototype,{onModuleDefined:function(t){if(this.exist(t.name)&&(this.modules[t.name]=t,this.names.splice(this.names.indexOf(t.name),1)),!this.names.length){var e=this.app;e.Modules.off("MODULE_DEFINED",this.onModuleDefined,this);var n=o.extend(this.modules,e.Modules.getDeps(this.modules));this.next(n,this)}return this},exist:function(t){return o.find(this.names,function(e){return e===t})}});var l=function(t){this.app=t,this.modules={},this.init()};o.extend(l.prototype,u(),{get:function(t){return this.modules[t].exportFn},getModule:function(t){return this.modules[t]},define:function(t,e){var n=this;return new a(t,e,function(e){n.modules[t]=e,n.trigger("MODULE_DEFINED",e)},this.app),this},init:function(){return window.wellDefine=this.define.bind(this),this},findBy:function(t,e){return o.find(this.modules,function(n){return n.options[t]===e},this)},require:function(t,e,n){var i=this.findMissing(t);return i.length?(new h(o.clone(i),e,this.app),this.app.isProduction||(i=o.map(i,function(t){return this.app.transformToPath(t)},this),this.vendorRequire(i,function(){},n)),this):e(this.pack(t))},requireConfig:function(){var t=this.app.options;return requirejs.config({urlArgs:t.cache===!1?(new Date).getTime():"",waitSeconds:60,baseUrl:t.appRoot,paths:{well:t.wellRoot,plugins:t.pluginsRoot,vendor:t.vendorRoot}}),this},vendorRequire:function(t,e,n){require(t,e,n)},exist:function(t){return o.find(this.modules,function(e){return e.name===t},this)},findMissing:function(t){return o.filter(t,function(t){return!this.exist(t)},this)},pack:function(t){var e={};return o.each(t,function(t){e[t]=this.getModule(t)},this),o.extend(e,this.getDeps(e))},getDeps:function(t){var e={};return o.each(t,function(t){o.each(t.deps,function(t){e[t]=this.getModule(t)},this)},this),e}}),window.WellModuleModules=l;var p=function(t,e){this.isProduction=t.isProduction,this.options=t,this.name=this.options.appName||"WellApp",window[this.name]=this,"function"==typeof define&&define.amd&&(define.amd=e),this.init()};o.extend(p.prototype,{init:function(){if(this.Modules=new l(this),this.isProduction||this.Modules.requireConfig(),!this.options.strategy)return console.log("There is no application strategy defined");var t=this;this.Modules.require([this.options.strategy],function(){t.Strategy=new(t.Modules.get(t.options.strategy))},function(t){console.log("Error in strategy loading! ",t)})},transformToPath:function(t){return t?t.split(/(?=[A-Z])/).join("-").toLowerCase().split(":-").join("/"):t},transformToName:function(t){return t?(t=this.capitalize(t.replace(/^\//,"").split("/")).join(":"),this.capitalize(t.split("-")).join("")):void 0},capitalize:function(t){return o.map(t,function(t){return t.charAt(0).toUpperCase()+t.slice(1)})}}),new p(window.WellConfig||{})}();